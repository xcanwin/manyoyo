<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <title>MANYOYO Web</title>
    <link rel="stylesheet" href="/app/frontend/app.css" />
    <link rel="stylesheet" href="/app/vendor/xterm.css" />
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="sidebar-top">
                <div class="brand-wrap">
                    <div class="brand">MANYOYO Web</div>
                    <div class="brand-sub">Container Session Console</div>
                </div>
                <div class="sidebar-actions">
                    <button type="button" id="openConfigBtn" class="secondary">配置</button>
                    <button type="button" id="openCreateBtn">新建</button>
                </div>
                <button
                    type="button"
                    id="mobileSidebarClose"
                    class="secondary mobile-sidebar-close"
                    aria-label="关闭会话列表"
                >关闭</button>
            </div>
            <div class="session-head">
                <span>会话</span>
                <span id="sessionCount">0 个</span>
            </div>
            <div id="sessionList"></div>
        </aside>
        <main class="main">
            <header class="header">
                <div class="header-main">
                    <div class="header-main-top">
                        <button
                            type="button"
                            id="mobileSessionToggle"
                            class="secondary mobile-session-toggle"
                            aria-expanded="false"
                            aria-controls="sessionList"
                        >会话</button>
                        <h1 id="activeTitle">未选择会话</h1>
                        <button
                            type="button"
                            id="mobileActionsToggle"
                            class="secondary mobile-actions-toggle"
                            aria-expanded="false"
                            aria-controls="headerActions"
                        >更多</button>
                    </div>
                    <div id="activeMeta">请选择左侧会话</div>
                </div>
                <div class="header-actions" id="headerActions">
                    <button type="button" id="refreshBtn" class="secondary">刷新</button>
                    <button type="button" id="removeBtn" class="danger-outline">删除容器</button>
                    <button type="button" id="removeAllBtn" class="danger">删除对话</button>
                </div>
            </header>
            <section class="mode-switch" id="modeSwitch">
                <div class="mode-switch-left">
                    <button type="button" id="modeCommandBtn" class="secondary is-active">命令模式</button>
                    <button type="button" id="modeTerminalBtn" class="secondary">交互终端</button>
                </div>
                <div class="mode-terminal-controls">
                    <button type="button" id="terminalConnectBtn">连接终端</button>
                    <button type="button" id="terminalDisconnectBtn" class="secondary">断开终端</button>
                    <span id="terminalStatus" class="terminal-status">未连接</span>
                </div>
            </section>
            <section id="messages"></section>
            <section id="terminalPanel" hidden>
                <div id="terminalScreen" aria-label="终端输出区域"></div>
                <div class="terminal-foot">点击终端后可直接输入；适用于 codex / claude 等交互式 agent。</div>
            </section>
            <form class="composer" id="composer">
                <div class="composer-inner">
                    <textarea id="commandInput" placeholder="输入容器命令，例如: ls -la"></textarea>
                    <button type="submit" id="sendBtn">发送</button>
                </div>
                <div class="composer-foot">
                    <span>Enter 发送 · Shift/Alt + Enter 换行</span>
                    <span id="sendState" class="send-state">未选择会话</span>
                </div>
            </form>
        </main>
        <div id="sidebarBackdrop" class="sidebar-backdrop" hidden></div>

        <div id="configModal" class="modal-backdrop" hidden>
            <section class="modal" role="dialog" aria-modal="true" aria-labelledby="configModalTitle">
                <header class="modal-header">
                    <h2 id="configModalTitle">编辑配置 (~/.manyoyo/manyoyo.json)</h2>
                    <button type="button" id="configCancelBtn" class="secondary">关闭</button>
                </header>
                <div class="modal-body">
                    <div id="configPath" class="modal-tip"></div>
                    <textarea id="configEditor" class="config-editor" spellcheck="false"></textarea>
                    <div id="configError" class="modal-error" hidden></div>
                </div>
                <footer class="modal-footer">
                    <button type="button" id="configReloadBtn" class="secondary">重新加载</button>
                    <button type="button" id="configSaveBtn">保存</button>
                </footer>
            </section>
        </div>

        <div id="createModal" class="modal-backdrop" hidden>
            <section class="modal" role="dialog" aria-modal="true" aria-labelledby="createModalTitle">
                <header class="modal-header">
                    <h2 id="createModalTitle">新建容器会话</h2>
                    <button type="button" id="createCancelBtn" class="secondary">关闭</button>
                </header>
                <form id="createSessionForm" class="modal-body">
                    <div class="form-grid">
                        <label>run
                            <select id="createRun">
                                <option value="">(不使用 run)</option>
                            </select>
                        </label>
                        <label>hostPath<input id="createHostPath" placeholder="/abs/path/project" /></label>
                        <label>containerName<input id="createContainerName" placeholder="my-dev 或 my-{now}" /></label>
                        <label>containerPath<input id="createContainerPath" placeholder="/workspace" /></label>
                        <label>imageName<input id="createImageName" placeholder="localhost/xcanwin/manyoyo" /></label>
                        <label>imageVersion<input id="createImageVersion" placeholder="1.7.4-common" /></label>
                        <label>containerMode
                            <select id="createContainerMode">
                                <option value="">(跟随默认)</option>
                                <option value="common">common</option>
                                <option value="dind">dind</option>
                                <option value="sock">sock</option>
                            </select>
                        </label>
                        <label>shellPrefix<input id="createShellPrefix" placeholder="例如 IS_SANDBOX=1" /></label>
                        <label>shell<input id="createShell" placeholder="例如 claude / codex" /></label>
                        <label>shellSuffix<input id="createShellSuffix" placeholder="例如 --dangerously-skip-permissions" /></label>
                        <label>yolo<input id="createYolo" placeholder="例如 c / cx / gm / oc" /></label>
                    </div>
                    <label class="text-block">env (KEY=VALUE，每行一项)
                        <textarea id="createEnv" placeholder="KEY=value"></textarea>
                    </label>
                    <label class="text-block">envFile (绝对路径，每行一项)
                        <textarea id="createEnvFile" placeholder="/abs/path/.env"></textarea>
                    </label>
                    <label class="text-block">volumes (每行一项)
                        <textarea id="createVolumes" placeholder="/host/path:/container/path"></textarea>
                    </label>
                    <div id="createError" class="modal-error" hidden></div>
                    <footer class="modal-footer">
                        <button type="button" id="createResetBtn" class="secondary">重置默认</button>
                        <button type="submit" id="createSubmitBtn">创建并进入</button>
                    </footer>
                </form>
            </section>
        </div>
    </div>

    <script src="/app/vendor/xterm.js"></script>
    <script src="/app/vendor/xterm-addon-fit.js"></script>
    <script src="/app/frontend/app.js"></script>
</body>
</html>
