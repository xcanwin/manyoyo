---
name: agents-power
description: "统一评估、初始化和更新当前仓库的 AGENTS.md。用户提到 $agents-power，或要求“评估 AGENTS.md”“检查指引漂移”“生成/更新 AGENTS.md”“先评估再修改”时使用。默认先评估：AGENTS.md 存在时走 audit-only，不存在时走 audit-then-apply。"
---

# Agents Power（中文版）

统一处理 `AGENTS.md` 的评估与落地修改，确保规则与仓库事实一致、输出简洁可执行。

## 模式判定
- `audit-only`：用户仅要求评估、检查漂移、给建议时使用；不改文件。
- `apply`：用户明确要求生成或更新 `AGENTS.md` 时使用；允许改文件。
- `audit-then-apply`：用户要求“先评估再修改”时使用。
- 若用户未明确指定模式：`AGENTS.md` 存在时默认 `audit-only`；`AGENTS.md` 不存在时默认 `audit-then-apply`。

## 核心流程
1. 读取 `references/workflow.md`，先执行最小探测。
2. 按探测结果分支处理（空目录、非 Git、存在构建文件等），仅提取可验证事实。
3. 根据模式输出评估结果，或进入生成/更新流程。
4. 仅在 `apply`/`audit-then-apply` 模式下读取 `assets/AGENTS.zh.template.md` 起草内容。
5. 写入前读取 `references/quality-checklist.md` 完成自检。
6. 输出结论与变更点；未明确要求时不自动提交。

## 执行规则
- 优先最小必要改动，避免无关重构。
- 默认中文沟通；回复简洁、可执行。
- 不提供时间预估或时间承诺。
- 探测仓库时优先遵守 `.gitignore`，并默认忽略临时目录（如 `.agents/`、`temp/`、`tmp/`、`.tmp/`）。
- 命令需在“空目录/非 Git 仓库”场景下可安全降级，不因单点失败中断任务。
- 内容必须基于仓库事实，不做臆测。

## Audit 输出格式
使用以下紧凑模板：

```md
结论: 需要更新 / 暂不需要更新

建议尽快改
1. ...
2. ...

可选补充
1. ...
2. ...

无需改动
- ...
```

每条建议应包含：`AGENTS.md` 位置、变更原因、1-2 行最小修改方向。

## Apply 输出必备章节
确保最终 `AGENTS.md` 包含以下章节：
- `# 仓库协作指引`
- `## 协作偏好`
- `## 项目结构与模块组织`
- `## 构建、测试与开发命令`
- `## 编码风格与命名约定`
- `## TDD 模式`
- `## 测试指引`
- `## 提交与 PR 指引`
- `## 变更执行检查清单`

## 兜底处理
- 缺少关键证据（如无构建脚本、无测试框架）时，在 `AGENTS.md` 中明确写明。
- 非 Git 仓库时跳过 `git log`，并明确说明无法提取提交风格。
- 最终输出不得保留模板占位符。
- 若按忽略规则过滤后当前目录为空，直接基于模板生成最小可用 `AGENTS.md`。
